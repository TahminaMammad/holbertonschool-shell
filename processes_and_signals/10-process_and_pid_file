#!/usr/bin/env bash
# This script creates a PID file, runs indefinitely, and uses signal trapping (SIGTERM, SIGINT, SIGQUIT) for controlled behavior and cleanup.

PID_FILE="/var/run/myscript.pid"

# --- Cleanup and Termination Function ---
cleanup() {
    # Delete the PID file if it exists.
    if [ -f "$PID_FILE" ]; then
        rm -f "$PID_FILE"
    fi
    # Terminate the script gracefully.
    exit 0
}

# --- Signal Traps ---

# SIGTERM (kill command): Display message, then cleanup and terminate.
trap "echo I hate the kill command; cleanup" SIGTERM

# SIGQUIT (Ctrl+\): Cleanup and terminate silently.
trap "cleanup" SIGQUIT

# SIGINT (Ctrl+C): Display message, but DO NOT terminate. Resume the loop.
trap "echo Y U no love me?!" SIGINT

# --- Startup ---

# Create the PID file containing the script's PID ($$). Requires sudo access.
echo $$ > "$PID_FILE"

# --- Main Infinite Loop ---

while true; do
    echo "To infinity and beyond"
    sleep 1
done
